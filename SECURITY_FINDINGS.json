{
  "audit_metadata": {
    "date": "2024-11-07",
    "scope": "Python FastAPI/Django services, Docker configuration, dependency files",
    "total_issues": 19,
    "tools_used": ["manual code review", "grep", "pattern matching", "dependency analysis"]
  },
  "summary_by_severity": {
    "CRITICAL": 3,
    "HIGH": 6,
    "MEDIUM": 8,
    "LOW": 2
  },
  "findings": [
    {
      "id": 1,
      "severity": "CRITICAL",
      "category": "Code Injection",
      "title": "Remote Code Execution via eval()",
      "file": "/Users/fab/GitHub/wildbox/open-security-agents/app/main.py",
      "line": 266,
      "description": "Using eval() to deserialize untrusted data from Redis allows arbitrary code execution",
      "vulnerable_code": "task_metadata = eval(task_metadata_str.decode())",
      "risk": "Remote Code Execution (RCE)",
      "fix": "Replace with json.loads(task_metadata_str.decode())",
      "cwe": "CWE-95: Improper Neutralization of Directives in Dynamically Evaluated Code"
    },
    {
      "id": 2,
      "severity": "CRITICAL",
      "category": "Hardcoded Credentials",
      "title": "Credentials Committed to Repository",
      "file": "/Users/fab/GitHub/wildbox/open-security-identity/.env",
      "line": "2,5,10-12",
      "description": "Database passwords, JWT secrets, and API keys hardcoded in .env file committed to git",
      "issues": [
        "Database password in DATABASE_URL",
        "JWT secret key (INSECURE-DEFAULT-JWT-SECRET-CHANGE-THIS)",
        "Stripe test keys"
      ],
      "risk": "Credential exposure, unauthorized access",
      "fix": "Remove from git history, ensure .env is in .gitignore, use environment variables",
      "cwe": "CWE-798: Use of Hard-Coded Credentials"
    },
    {
      "id": 3,
      "severity": "CRITICAL",
      "category": "Authentication",
      "title": "Missing Authentication on Critical Endpoints",
      "files": [
        {
          "path": "/Users/fab/GitHub/wildbox/open-security-agents/app/main.py",
          "line": 180
        },
        {
          "path": "/Users/fab/GitHub/wildbox/open-security-responder/app/main.py",
          "line": 133
        }
      ],
      "description": "Endpoints that execute critical operations have no authentication checks",
      "vulnerable_endpoints": [
        "/v1/analyze (POST)",
        "/v1/playbooks/{playbook_id}/execute (POST)"
      ],
      "risk": "Unauthorized access to core functionality, data compromise",
      "fix": "Add get_current_user dependency to endpoints",
      "cwe": "CWE-306: Missing Authentication for Critical Function"
    },
    {
      "id": 4,
      "severity": "HIGH",
      "category": "CORS",
      "title": "Overly Permissive CORS Configuration",
      "files": [
        "/Users/fab/GitHub/wildbox/open-security-agents/app/main.py:91",
        "/Users/fab/GitHub/wildbox/open-security-responder/app/main.py:79",
        "/Users/fab/GitHub/wildbox/open-security-data/app/config.py:64"
      ],
      "vulnerable_code": "allow_origins=['*'], allow_credentials=True",
      "risk": "CSRF attacks, data exfiltration",
      "fix": "Replace with specific allowed domains",
      "cwe": "CWE-346: Origin Validation Error"
    },
    {
      "id": 5,
      "severity": "HIGH",
      "category": "SQL Injection",
      "title": "SQL Injection in osquery Table Validation",
      "file": "/Users/fab/GitHub/wildbox/open-security-sensor/sensor/collectors/osquery_manager.py",
      "line": 411,
      "description": "Dynamic table names in SQL queries without proper parameterization",
      "vulnerable_code": "test_query = f\"SELECT COUNT(*) FROM {table} LIMIT 1;\"",
      "risk": "SQL injection, database compromise",
      "fix": "Use osquery's native validation APIs",
      "cwe": "CWE-89: SQL Injection"
    },
    {
      "id": 6,
      "severity": "HIGH",
      "category": "Rate Limiting",
      "title": "Missing Rate Limiting on Public Endpoints",
      "files": [
        "/Users/fab/GitHub/wildbox/open-security-agents/app/main.py",
        "/Users/fab/GitHub/wildbox/open-security-responder/app/main.py"
      ],
      "affected_endpoints": [
        "/v1/analyze",
        "/v1/playbooks/{id}/execute"
      ],
      "risk": "Denial of Service (DoS), resource exhaustion",
      "fix": "Add rate limiting decorators using slowapi",
      "cwe": "CWE-770: Allocation of Resources Without Limits"
    },
    {
      "id": 7,
      "severity": "HIGH",
      "category": "Information Disclosure",
      "title": "Plaintext Logging of Sensitive Data",
      "files": [
        {
          "path": "/Users/fab/GitHub/wildbox/open-security-identity/demo.py",
          "line": 22
        },
        {
          "path": "/Users/fab/GitHub/wildbox/open-security-identity/auth.py",
          "line": 291
        }
      ],
      "vulnerable_code": "print(f\"Password: {password}\")",
      "risk": "Credentials exposed in logs",
      "fix": "Remove password logging, use proper logger without sensitive data",
      "cwe": "CWE-532: Insertion of Sensitive Information into Log File"
    },
    {
      "id": 8,
      "severity": "HIGH",
      "category": "Hardcoded Secrets",
      "title": "Default Secrets in docker-compose.yml",
      "file": "/Users/fab/GitHub/wildbox/docker-compose.yml",
      "lines": "28-36,58",
      "issues": [
        "Default postgres password fallback",
        "Default JWT secret fallback",
        "Exposed API key: wbx-FtWXeuB_1VZut2DjxpT2TCjtVzeNjem8W0V3OA38M90",
        "Default Stripe secrets"
      ],
      "risk": "Data compromise, unauthorized access",
      "action_required": "ROTATE API KEY wbx-FtWXeuB_1VZut2DjxpT2TCjtVzeNjem8W0V3OA38M90 IMMEDIATELY",
      "fix": "Remove all default fallback values",
      "cwe": "CWE-798: Use of Hard-Coded Credentials"
    },
    {
      "id": 9,
      "severity": "MEDIUM",
      "category": "Input Validation",
      "title": "Missing Input Validation on Unprotected Endpoints",
      "file": "/Users/fab/GitHub/wildbox/open-security-agents/app/main.py",
      "line": 181,
      "risk": "Injection attacks, unexpected behavior",
      "fix": "Add Pydantic validators for IOC type and value",
      "cwe": "CWE-20: Improper Input Validation"
    },
    {
      "id": 10,
      "severity": "MEDIUM",
      "category": "Cryptography",
      "title": "Weak Hashing Algorithms Supported",
      "file": "/Users/fab/GitHub/wildbox/open-security-tools/app/tools/hash_generator/main.py",
      "lines": "28-65",
      "description": "MD5 and SHA1 still supported despite being broken/deprecated",
      "algorithms": ["md5 (BROKEN)", "sha1 (DEPRECATED)"],
      "risk": "Weak cryptography, compliance issues",
      "fix": "Remove or move to legacy-only mode",
      "cwe": "CWE-327: Use of a Broken or Risky Cryptographic Algorithm"
    },
    {
      "id": 11,
      "severity": "MEDIUM",
      "category": "CSRF Protection",
      "title": "Missing CSRF Protection Validation",
      "file": "/Users/fab/GitHub/wildbox/open-security-identity/app/config.py",
      "line": 40,
      "vulnerable_code": "cors_allow_headers: list[str] = ['*']",
      "risk": "Cross-Site Request Forgery",
      "fix": "Explicitly list allowed headers, add CSRF middleware",
      "cwe": "CWE-352: Cross-Site Request Forgery (CSRF)"
    },
    {
      "id": 12,
      "severity": "MEDIUM",
      "category": "Security Headers",
      "title": "Missing Security Headers",
      "files": "All FastAPI applications",
      "risk": "Clickjacking, XSS, MIME type sniffing",
      "missing_headers": [
        "X-Content-Type-Options",
        "X-Frame-Options",
        "X-XSS-Protection",
        "Strict-Transport-Security",
        "Content-Security-Policy"
      ],
      "fix": "Add security headers middleware",
      "cwe": "CWE-693: Protection Mechanism Failure"
    },
    {
      "id": 13,
      "severity": "MEDIUM",
      "category": "Command Injection",
      "title": "Subprocess Usage Without Input Validation",
      "file": "/Users/fab/GitHub/wildbox/open-security-sensor/sensor/collectors/log_forwarder.py",
      "line": 281,
      "risk": "Command injection attacks",
      "fix": "Use explicit list form with validated parameters",
      "cwe": "CWE-78: Improper Neutralization of Special Elements used in an OS Command"
    },
    {
      "id": 14,
      "severity": "MEDIUM",
      "category": "Deserialization",
      "title": "Insecure Deserialization - json.loads() Without Validation",
      "file": "/Users/fab/GitHub/wildbox/open-security-cspm/app/main.py",
      "lines": "Multiple",
      "risk": "Injection attacks, type confusion",
      "fix": "Use Pydantic models for schema validation",
      "cwe": "CWE-502: Deserialization of Untrusted Data"
    },
    {
      "id": 15,
      "severity": "MEDIUM",
      "category": "Configuration",
      "title": "Default Django SECRET_KEY",
      "file": "/Users/fab/GitHub/wildbox/open-security-guardian/guardian/settings.py",
      "line": 23,
      "vulnerable_code": "SECRET_KEY = os.getenv('SECRET_KEY', 'your-secret-key-here-change-in-production')",
      "risk": "Session hijacking, CSRF token forgery",
      "fix": "Require environment variable, validate against defaults",
      "cwe": "CWE-798: Use of Hard-Coded Credentials"
    },
    {
      "id": 16,
      "severity": "LOW",
      "category": "API Security",
      "title": "Missing API Key Validation Consistency",
      "file": "/Users/fab/GitHub/wildbox/open-security-tools/app/api/router.py",
      "line": 22,
      "risk": "Information disclosure",
      "fix": "Ensure consistent error responses"
    },
    {
      "id": 17,
      "severity": "LOW",
      "category": "Configuration",
      "title": "Debug Flag Could Be Enabled in Production",
      "file": "/Users/fab/GitHub/wildbox/docker-compose.yml",
      "line": 59,
      "risk": "Information disclosure in errors",
      "fix": "Add validation that DEBUG is false in production"
    },
    {
      "id": 18,
      "severity": "LOW",
      "category": "Testing",
      "title": "Weak Test Passwords",
      "file": "/Users/fab/GitHub/wildbox/verify_authentication_complete.py",
      "line": 581,
      "vulnerable_code": "password = 'demopassword123'",
      "risk": "Weak authentication in tests",
      "fix": "Use stronger test passwords"
    },
    {
      "id": 19,
      "severity": "LOW",
      "category": "Documentation",
      "title": "Missing API Documentation Security",
      "description": "Swagger/OpenAPI docs exposed at /docs without authentication",
      "risk": "Information disclosure",
      "fix": "Disable /docs in production or add authentication"
    }
  ]
}
