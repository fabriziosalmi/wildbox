# Temporary fix for nginx upstream resolution issues
# This file contains improved upstream definitions that handle missing servers

# Improved upstream definitions with resolver and better error handling
upstream cspm_service {
    server open-security-cspm:8007 max_fails=3 fail_timeout=30s;
    server 127.0.0.1:8007 backup;  # Fallback to prevent startup failure
    keepalive 32;
}

upstream sensor_service {
    server open-security-sensor:8004 max_fails=3 fail_timeout=30s;
    server 127.0.0.1:8004 backup;  # Fallback to prevent startup failure
    keepalive 32;
}

upstream dashboard_service {
    server open-security-dashboard:3000 max_fails=3 fail_timeout=30s;
    server 127.0.0.1:3000 backup;  # Fallback to prevent startup failure
    keepalive 32;
}

# Add resolver for dynamic DNS resolution
resolver 127.0.0.11 valid=30s;
